# Руководство для новичков по созданию Web-сервиса в 1С

## Подготовка окружения

### 1. Проверка установленных компонентов

**Windows 11 Enterprise:**
- Убедитесь, что установлена платформа 1С:Предприятие 8.3
- Проверьте наличие веб-сервера Apache
- Установите Postman для тестирования

### 2. Запуск демонстрационной конфигурации

1. **Запустите 1С:Предприятие**
2. **Создайте новую информационную базу:**
   - Выберите "Демонстрационная конфигурация Web-сервисов"
   - Режим запуска: "Толстый клиент"
   - Режим аутентификации: "Выбирать автоматически"

## Создание первого Web-сервиса

### Шаг 1: Открытие конфигуратора

1. Запустите 1С в режиме "Конфигуратор"
2. Откройте дерево конфигурации

### Шаг 2: Создание WS-Сервиса

1. В дереве конфигурации найдите раздел **"Общие" → "WS-Сервисы"**
2. Щелкните правой кнопкой → **"Добавить"**
3. Заполните свойства:

```
Имя: МойПервыйСервис
Пространство имен: http://localhost/myservice
ИмяВерсия: v1
КорневойURL: http://localhost/myservice
```

### Шаг 3: Добавление операций сервиса

1. В свойствах сервиса перейдите на вкладку **"Операции"**
2. Добавьте первую операцию:

**Операция 1: "ПриветМир"**
```
Имя: ПриветМир
Возвращаемое значение: Строка
```

**Операция 2: "ПолучитьТекущуюДату"**
```
Имя: ПолучитьТекущуюДату
Возвращаемое значение: Дата
```

**Операция 3: "СложитьЧисла"**
```
Имя: СложитьЧисла
Параметры:
  - Число1 (Число)
  - Число2 (Число)
Возвращаемое значение: Число
```

## Разработка модуля Web-сервиса

### Шаг 4: Написание кода операций

Откройте модуль сервиса и добавьте код:

```bsl
// WS-Сервис: МойПервыйСервис

// Простая операция без параметров
Функция ПриветМир() Экспорт
    
    Возврат "Привет, мир! Это мой первый Web-сервис!";
    
КонецФункции

// Операция с возвратом даты
Функция ПолучитьТекущуюДату() Экспорт
    
    // Возвращаем текущую дату и время сервера
    Возврат ТекущаяДата();
    
КонецФункции

// Операция с параметрами
Функция СложитьЧисла(Число1, Число2) Экспорт
    
    // Проверка параметров
    Если Число1 = Неопределено Тогда
        ВызватьИсключение "Не указан параметр Число1";
    КонецЕсли;
    
    Если Число2 = Неопределено Тогда
        ВызватьИсключение "Не указан параметр Число2";
    КонецЕсли;
    
    // Выполнение вычисления
    Результат = Число1 + Число2;
    
    Возврат Результат;
    
КонецФункции

// Операция с различными типами данных
Функция ПолучитьИнформациюОСистеме() Экспорт
    
    Результат = Новый Структура;
    Результат.Вставить("ВерсияПлатформы", ВерсияПлатформы());
    Результат.Вставить("ТекущаяДата", ТекущаяДата());
    Результат.Вставить("ВремяРаботыСистемы", ТекущееВремяСеанса());
    Результат.Вставить("КоличествоПользователей", 1);
    
    Возврат Результат;
    
КонецФункции
```

### Шаг 5: Публикация Web-сервиса

1. **В конфигураторе:** Меню "Администрирование" → "Публикация Web-сервисов"
2. **Настройки публикации:**
   - Каталог публикации: `C:\WebServices\MyFirstService\`
   - Веб-сервер: Apache
   - Адрес публикации: `http://localhost/MyFirstService`
3. Нажмите "Опубликовать"

## Настройка веб-сервера Apache

### Шаг 6: Конфигурация Apache

1. Откройте файл `httpd.conf` Apache
2. Добавьте конфигурацию:

```apache
# Конфигурация для 1С Web-сервисов
LoadModule onesoft_web_server_module "C:\Program Files\1cv8\8.3.xx.xxxx\bin\wsap24.dll"

<Location "/MyFirstService">
    SetHandler onesoft-web-handler
</Location>

Alias /MyFirstService "C:/WebServices/MyFirstService/"
<Directory "C:/WebServices/MyFirstService/">
    Options None
    AllowOverride None
    Require all granted
</Directory>
```

3. Перезапустите Apache

## Тестирование в Postman

### Шаг 7: Тестирование операции "ПриветМир"

1. **Создайте новый запрос в Postman:**
   - Метод: POST
   - URL: `http://localhost/MyFirstService/ws/МойПервыйСервис?wsdl`

2. **Заголовки:**
   ```
   Content-Type: text/xml; charset=utf-8
   SOAPAction: http://localhost/myservice/МойПервыйСервис#ПриветМир
   ```

3. **Тело запроса (XML):**
```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:mys="http://localhost/myservice">
    <soap:Body>
        <mys:ПриветМир/>
    </soap:Body>
</soap:Envelope>
```

4. **Отправьте запрос** - вы должны получить ответ:

```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:mys="http://localhost/myservice">
    <soap:Body>
        <mys:ПриветМирResponse>
            <mys:return>Привет, мир! Это мой первый Web-сервис!</mys:return>
        </mys:ПриветМирResponse>
    </soap:Body>
</soap:Envelope>
```

### Шаг 8: Тестирование операции "СложитьЧисла"

**Тело запроса:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:mys="http://localhost/myservice">
    <soap:Body>
        <mys:СложитьЧисла>
            <mys:Число1>15</mys:Число1>
            <mys:Число2>25</mys:Число2>
        </mys:СложитьЧисла>
    </soap:Body>
</soap:Envelope>
```

**Ожидаемый ответ:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:mys="http://localhost/myservice">
    <soap:Body>
        <mys:СложитьЧислаResponse>
            <mys:return>40</mys:return>
        </mys:СложитьЧислаResponse>
    </soap:Body>
</soap:Envelope>
```

## Расширенные примеры

### Создание сервиса с обработкой ошибок

```bsl
// WS-Сервис: СервисСОшибками

Функция ДелитьЧисла(Делимое, Делитель) Экспорт
    
    // Проверка входных параметров
    Если Делимое = Неопределено Тогда
        ВызватьИсключение "Не указано делимое";
    КонецЕсли;
    
    Если Делитель = Неопределено Тогда
        ВызватьИсключение "Не указан делитель";
    КонецЕсли;
    
    // Проверка деления на ноль
    Если Делитель = 0 Тогда
        ВызватьИсключение "Деление на ноль невозможно";
    КонецЕсли;
    
    Попытка
        Результат = Делимое / Делитель;
    Исключение
        // Логируем ошибку
        Сообщение = "Ошибка при делении: " + ОписаниеОшибки();
        ВызватьИсключение Сообщение;
    КонецПопытки;
    
    Возврат Результат;
    
КонецФункции

Функция ПолучитьВерсию() Экспорт
    
    ИнформацияОСистеме = Новый СистемнаяИнформация;
    
    Результат = Новый Структура;
    Результат.Вставить("ВерсияПлатформы", ИнформацияОСистеме.ВерсияПриложения);
    Результат.Вставить("ВерсияБазы", КонфигурацияБазыДанных.Версия);
    Результат.Вставить("ДатаСборки", КонфигурацияБазыДанных.ДатаИзменения);
    
    Возврат Результат;
    
КонецФункции
```

### Тестирование с ошибками в Postman

**Запрос с делением на ноль:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
               xmlns:mys="http://localhost/myservice">
    <soap:Body>
        <mys:ДелитьЧисла>
            <mys:Делимое>10</mys:Делимое>
            <mys:Делитель>0</mys:Делитель>
        </mys:ДелитьЧисла>
    </soap:Body>
</soap:Envelope>
```

**Ответ с ошибкой:**
```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Body>
        <soap:Fault>
            <faultcode>soap:Server</faultcode>
            <faultstring>Деление на ноль невозможно</faultstring>
        </soap:Fault>
    </soap:Body>
</soap:Envelope>
```

## Полезные советы для новичков

### 1. Отладка Web-сервисов

```bsl
Функция ОтладочнаяФункция(Параметр) Экспорт
    
    // Логирование для отладки
    Сообщить("Вызвана ОтладочнаяФункция с параметром: " + Параметр);
    
    Попытка
        // Ваш код здесь
        Результат = "Обработан: " + Параметр;
        
        Сообщить("Функция завершена успешно. Результат: " + Результат);
        Возврат Результат;
        
    Исключение
        Ошибка = ОписаниеОшибки();
        Сообщить("Ошибка в функции: " + Ошибка);
        ВызватьИсключение Ошибка;
    КонецПопытки;
    
КонецФункции
```

### 2. Проверка работоспособности

1. **Проверка WSDL:**
   Откройте в браузере: `http://localhost/MyFirstService/ws/МойПервыйСервис?wsdl`

2. **Проверка доступности:**
   ```bash
   curl -I http://localhost/MyFirstService/
   ```

### 3. Частые проблемы и решения

**Проблема:** "404 Not Found"
- Решение: Проверьте путь публикации и конфигурацию Apache

**Проблема:** "500 Internal Server Error"
- Решение: Проверьте код модуля на ошибки, посмотрите логи 1С

**Проблема:** "SOAP Action not found"
- Решение: Проверьте правильность указания SOAPAction в заголовках

## Самостоятельное задание

1. Создайте Web-сервис с тремя операциями:
   - Возврат текущего времени
   - Конкатенация двух строк
   - Проверка числа на четность

2. Протестируйте каждую операцию в Postman

3. Добавьте обработку ошибок для всех операций

Это руководство поможет вам создать и протестировать ваш первый Web-сервис в 1С. Начинайте с простых операций и постепенно переходите к более сложной функциональности!
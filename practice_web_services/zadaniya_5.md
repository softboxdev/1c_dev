

### Введение в Битрикс для электронной коммерции

**1С-Битрикс: Управление сайтом** — это мощный фреймворк для создания веб-проектов любой сложности. Модуль **"Интернет-магазин"** является одним из его ключевых компонентов, предоставляя готовый функционал для полноценной онлайн-торговли.

---

### 1. Настройка модулей “Интернет-магазин”, “Валюты”, “Торговый каталог”

Это базовый этап, основа для всего магазина.

#### **Модуль "Интернет-магазин"**
*   **Активация:** Модуль необходимо установить и активировать в разделе `Marketplace > Модули`.
*   **Мастер настройки:** После активации запускается мастер, который помогает провести первоначальную настройку:
    *   **Типы плательщиков:** Юридические и физические лица, с разными наборами свойств (адрес, ИНН и т.д.).
    *   **Местоположения:** Иерархическая структура (страна, регион, город) для доставки и налогов.
    *   **Службы доставки:** Настройка способов (курьер, самовывоз, почта) с привязкой к местоположениям и расчетом стоимости.
    *   **Статусы заказов:** Создание workflow заказа (Принят, Оплачен, Доставляется, Выполнен).
    *   **Платежные системы:** Настройка внутренних систем (например, робокасса) или внешних (о них ниже).

#### **Модуль "Валюты"**
*   **Находится:** `Настройки > Настройки продукта > Валюты`.
*   **Добавление валют:** Добавляете необходимые валюты (USD, EUR, KZT и т.д.).
*   **Настройка курсов:**
    *   **Ручной ввод:** Указываете курс вручную.
    *   **Автоматическое обновление:** Битрикс может автоматически получать курсы с сайта ЦБ РФ или других источников по расписанию.
*   **Формат отображения:** Настраиваете, как валюта будет показываться в публичной части (например, "100 ₽", "100 руб.").

#### **Модуль "Торговый каталог" (iblock)**
*   **Это ядро каталога товаров.** Технически основан на инфоблоках.
*   **Настройка:** Создаете инфоблок с типом "Торговый каталог" или "Каталог товаров".
*   **Важные параметры:**
    *   **Свойства:** Создаете свойства для товаров (цвет, размер, вес, материал и т.д.). Они бывают разных типов (строка, число, список, привязка к элементам).
    *   **Торговые предложения:** Ключевая концепция. Если товар имеет разные варианты (например, футболка одного фасона, но разных размеров и цветов), то создается:
        *   **Товар (SKU):** Футболка "Basic".
        *   **Торговые предложения:** Футболка "Basic" / Размер: M / Цвет: Белый. У каждого предложения своя цена, артикул и остаток.
    *   **Цены:** Настройка типов цен (Базовая, Оптовая, Розничная). Для каждого типа можно задавать правила округления, включать НДС.

---

### 2. Настройка и интеграция внешних платежных систем

Битрикс имеет унифицированный API для подключения любых платежных шлюзов.

**Общий алгоритм действий:**

1.  **Создание платежной системы:** `Магазин > Настройки > Платежные системы` > "Добавить".
2.  **Выбор обработчика:** Выбирается "Внешняя платежная система".
3.  **Заполнение параметров:**
    *   **Название:** "Онлайн-оплата картой (Тинькофф)".
    *   **Handler:** Указывается PHP-класс, который будет обрабатывать взаимодействие. Для популярных систем (Тинькофф, Сбер, ЮКасса) уже есть готовые модули из Маркетплейса.
4.  **Настройка параметров:**
    *   Вносятся данные, полученные от платежной системы: `Merchant ID`, `Секретный ключ`, `Ключ для подписи`.
    *   **URL для уведомлений:** Важный параметр. Указывается адрес на вашем сайте (`/bitrix/tools/sale_ps_result.php`), на который платежная система будет отправлять статус платежа. Это гарантирует, что статус заказа обновится, даже если пользователь закрыл браузер.
5.  **Настройка сценариев оплаты:** Определяется, когда покупатель будет перенаправлен на шлюз (до или после оформления заказа).

**Популярные модули:** Для удобства можно установить готовые решения из Маркетплейса Битрикс для Тинькофф, Сбера, ЮКассы, CloudPayments и других. Они автоматизируют большую часть рутинных настроек.

---

### 3. Проектирование и создание каталога товаров

Это стратегический этап, от которого зависит удобство управления и масштабируемость.

1.  **Проектирование структуры:**
    *   **Определение сущностей:** Что у вас будет? Товары, услуги, комплекты?
    *   **Группировка:** Создание логических разделов и подразделов. Например: "Электроника" -> "Смартфоны" -> "Apple".
    *   **Определение атрибутов:** Какие характеристики есть у товаров? Для смартфона: Диагональ экрана, Объем памяти, Цвет, Процессор. Эти атрибуты станут свойствами инфоблока.
    *   **Решение о предложениях:** Нужны ли торговые предложения? Если да, то какие свойства будут их характеризовать (Размер, Цвет), а какие будут общими для товара (Бренд, Страна-производитель).

2.  **Техническая реализация в Битриксе:**
    *   Создание инфоблока "Торговый каталог".
    *   Настройка разделов согласно спроектированной структуре.
    *   Создание свойств (атрибутов) с правильными типами.
    *   Включение поддержки торговых предложений (если нужно) и настройка их свойств.
    *   Настройка типов цен и скидок.

3.  **Загрузка товаров:**
    *   **Вручную:** Через админку для небольшого количества товаров.
    *   **Импорт из CSV/XML:** Через стандартный функционал Битрикс (`Магазин > Товары > Коммерческий каталог > Загрузка из CSV/XML`). Позволяет массово загружать товары, цены и остатки.
    *   **Через API:** Для програмmatic-ной загрузки.

---

### 4. Представление каталога в публичном разделе сайта

После создания "сырого" каталога в админке его нужно красиво отобразить для пользователей.

1.  **Компоненты Битрикс:** Основа для отображения. Используются готовые визуальные компоненты.
    *   `bitrix:catalog.section` — для отображения списка товаров в разделе.
    *   `bitrix:catalog.element` — для отображения карточки одного товара.
    *   `bitrix:catalog.smart.filter` — для отображения умного фильтра по свойствам.
    *   `bitrix:catalog.top` — для отображения товаров в слайдерах "Популярные товары".
    *   `bitrix:search.title` — для настройки поиска по каталогу.

2.  **Процесс верстки:**
    *   Верстальщик создает HTML/CSS шаблоны для страниц каталога, карточки товара и т.д.
    *   Разработчик "натягивает" верстку на компоненты Битрикс, настраивая пути, шаблоны вывода и подключая нужные свойства.

3.  **Ключевые возможности:**
    *   **Умный фильтр:** Позволяет фильтровать товары по любым свойствам (цена, бренд, цвет). Автоматически генерирует ЧПУ-ссылки (человекопонятные URL), что хорошо для SEO.
    *   **Сравнение товаров:** Пользователи могут добавлять товары к сравнению.
    *   **Отложенные товары (Избранное).**
    *   **Хлебные крошки:** Навигационная цепочка.
    *   **SEO-настройка:** Для каждого раздела и товара можно прописать уникальные Title, Description и Keywords.

---

### 5. Интеграция с «1С:Предприятие»

Это одна из сильнейших сторон Битрикс, позволяющая автоматизировать рутину.

**Для чего нужна интеграция?**
*   **Обмен товарами и остатками:** Автоматическое обновление каталога на сайте при изменении в 1С.
*   **Обмен заказами:** Заказы с сайта автоматически попадают в 1С для обработки.
*   **Обмен ценами:** Изменение цен и акций в 1С мгновенно отражается на сайте.

**Техническая реализация:**

1.  **Активация модуля "Обмен с 1С"** в админке Битрикс.
2.  **Настройка в 1С:** Используется стандартная конфигурация "Обмен данными с сайтом via Битрикс".
3.  **Создание профиля обмена:** В Битрикс создается профиль, где указывается:
    *   Адрес для обмена.
    *   Логин и пароль для авторизации 1С.
    *   Настройки расписания (например, обмен каждые 10 минут).
4.  **Сопоставление данных:** Самая важная часть. Нужно "связать" поля в Битриксе с полями в 1С:
    *   Какой каталог в Битрикс соответствует какому справочнику в 1С.
    *   Какое свойство "Цвет" в Битриксе соответствует реквизиту "Цвет" в 1С.

---

### 6. Виды использования сайта при интеграции с «1С:Предприятием»

Существует две основные схемы взаимодействия, которые определяют, где "живет" основная информация.

#### **Схема 1: Сайт как "витрина", 1С — как "бэк-офис" (Наиболее популярная)**

*   **Описание:** 1С является главной системой. Все товары, остатки, цены и характеристики хранятся и редактируются в ней. Сайт является лишь точкой продаж, которая синхронизируется с 1С.
*   **Направление обмена:**
    *   **Из 1С на сайт:** Товары, остатки, цены, характеристики.
    *   **С сайта в 1С:** Заказы, регистрационные данные клиентов.
*   **Плюсы:**
    *   **Один источник истины:** Не возникает путаницы, где правильные данные.
    *   **Идеально для интернет-магазинов:** Полная автоматизация, минимум ручного труда.
*   **Минусы:**
    *   Для быстрого изменения контента на сайте (например, SEO-текстов) нужно либо заводить их в 1С, либо редактировать вручную в Битриксе.

#### **Схема 2: Сайт как основной каталог, 1С — как система учета**

*   **Описание:** Полноценный каталог товаров ведется непосредственно в Битриксе. В 1С хранятся только минимальные данные (название, артикул, базовая цена) для проведения документов.
*   **Направление обмена:**
    *   **Из 1С на сайт:** Базовая номенклатура, остатки.
    *   **С сайта в 1С:** Заказы.
    *   *(Опционально) С сайта в 1С:* Обновленные товары, если редактирование было на сайте.
*   **Плюсы:**
    *   **Гибкость:** Маркетологи и контент-менеджеры могут легко менять описания, фото, заголовки прямо на сайте, не заходя в 1С.
    *   **Подходит для контентных проектов:** Где товар — это часть сложного контента.
*   **Минусы:**
    *   **Риск рассинхронизации:** Может возникнуть путаница, где актуальные данные.
    *   **Сложнее в поддержке:** Требует четких регламентов, кто и что редактирует.

#### **Схема 3: Упрощенный обмен (для небольших магазинов)**

*   **Описание:** Обмен происходит только в одну сторону — заказы с сайта выгружаются в 1С. Товары и цены ведутся вручную в Битриксе.
*   **Плюсы:** Простота настройки.
*   **Минусы:** Полностью ручное управление ассортиментом, высокий риск ошибок.

**Вывод:** В 95% случаев для интернет-магазина используется **Схема 1**, так как она обеспечивает максимальную автоматизацию и надежность, используя сильные стороны обеих систем.

Давайте углубимся в интеграцию с «1С:Предприятие» — одну из самых мощных и востребованных возможностей 1С-Битрикс.

### Подробное руководство по интеграции с «1С:Предприятие»

---

### **Для чего нужна интеграция?**

Интеграция решает три ключевые задачи автоматизации бизнеса:

1.  **Синхронизация товарного каталога:** Автоматическое обновление на сайте товаров, их описаний, характеристик, фотографий из 1С.
2.  **Синхронизация остатков и цен:** Мгновенное отражение на сайте актуальных остатков на складах и цен (включая акционные).
3.  **Выгрузка заказов:** Автоматическая передача новых заказов с сайта в 1С для обработки (формирование документов "Заказ покупателя", "Отгрузка", "Счет-фактура").

---

### **Техническая архитектура обмена**

*   **Протокол:** Обмен происходит по стандартизированному протокоду на основе **CommerceML 2.0** — это открытый XML-формат, специально разработанный для обмена коммерческими данными.
*   **Механизм:** **HTTP-запросы**. 1С "инициирует" обмен, обращаясь к специально сформированным на сайте страницам (веб-сервисам).
*   **Роль Битрикс:** Предоставляет веб-сервисы, которые понимают и генерируют CommerceML.
*   **Роль 1С:** Стандартные конфигурации 1С ("Управление торговлей", "Розница", "ERP") содержат встроенные механизмы для обмена с сайтами на Битрикс.

---

### **Пошаговая настройка интеграции**

#### **ШАГ 1: Подготовка в 1С-Битрикс**

1.  **Активация модуля:**
    *   Зайдите в `Marketplace > Модули`.
    *   Найдите и активируйте модуль **"Обмен с 1С"** (в старых версиях может называться "Обмен с "1С:Предприятие"").

2.  **Настройка прав:**
    *   Убедитесь, что пользователь, от имени которого будет работать обмен, имеет права на доступ к соответствующему функционалу (обычно это права администратора на момент настройки).

3.  **Создание профиля обмена:**
    *   Зайдите в `Магазин > Настройки > Настройки обмена с 1С > Профили обмена с 1С`.
    *   Нажмите "Добавить профиль".
    *   Заполните основные параметры:
        *   **Название:** Например, "Обмен с УТ 11".
        *   **Активность:** Галочка "Активен".
        *   **Адрес для обмена:** Это критически важная ссылка. Битрикс сгенерирует ее автоматически, например: `https://ваш-сайт.ru/bitrix/admin/1c_exchange.php`
        *   **Логин и Пароль:** Придумайте сложные логин и пароль для доступа к обмену. **Эти данные нужно будет указать в 1С**.

    

---

#### **ШАГ 2: Настройка в «1С:Предприятие»**

*Действия могут незначительно отличаться в зависимости от конфигурации (УТ, Розница, ERP).*

1.  **Включение функционала обмена:**
    *   В 1С зайдите в раздел "Администрирование" или "Настройки".
    *   Найдите пункт "Обмен с сайтами" / "Интернет-магазины" и создайте новую учетную запись для обмена.

2.  **Настройка соединения:**
    *   Введите **Адрес для обмена (URL)**, который вы скопировали в профиле Битрикс.
    *   Введите **Логин и Пароль**, заданные в профиле.
    *   Укажите **Версию протокола обмена: CommerceML 2.0**.

3.  **Сопоставление данных (Правила обмена):**
    *   Это самый важный и сложный этап. Вы должны "связать" сущности в 1С с сущностями в Битриксе.
    *   **Сопоставление справочников:**
        *   *Справочник "Номенклатура" в 1С* -> *Инфоблок "Торговый каталог" в Битриксе*.
        *   *Справочник "Склады" в 1С* -> *Склады в Битриксе*.
        *   *Справочник "Типы цен" в 1С* (например, "Розничная", "Оптовая") -> *Типы цен в Битриксе*.
    *   **Сопоставление свойств:** Для каждого свойства товара в Битриксе (цвет, размер) нужно указать, какому реквизиту или свойству в справочнике 1С оно соответствует.

---

#### **ШАГ 3: Настройка расписания и сценариев обмена**

*   **Расписание:** В 1С настраивается расписание автоматического обмена (например, каждые 10 минут). Битрикс всегда "ждет" запроса от 1С.
*   **Сценарии обмена (в Битриксе):** В настройках профиля обмена можно детально настроить:
    *   **Что выгружать из 1С:** Только товары, товары и цены, товары и остатки и т.д.
    *   **Поведение при обмене:** Что делать с товарами, которые пришли из 1С, но отсутствуют в файле обмена? (Деактивировать их на сайте или оставить как есть).
    *   **Обработка заказов:** В каком статусе заказ будет выгружен в 1С (например, "Принят").

---

### **Виды использования сайта при интеграции (Схемы работы)**

Выбор схемы определяет, где находится "главная" база товаров.

#### **Схема 1: Сайт как "Витрина" (Наиболее популярная)**

*   **Описание:** 1С — единый и главный источник правды о товарах. Все изменения (названия, цены, остатки, новые позиции) вносятся только в 1С и автоматически передаются на сайт.
*   **Направление обмена:**
    *   **Из 1С -> на Сайт:** Товары, остатки, цены, характеристики.
    *   **С Сайта -> в 1С:** Заказы, данные клиентов.
*   **Плюсы:**
    *   **Полная автоматизация:** Минимизация ручного труда.
    *   **Нет дублирования данных:** Исключаются расхождения между сайтом и складской программой.
    *   **Идеально для чистых E-commerce проектов.**
*   **Минусы:**
    *   Для редактирования SEO-полей (заголовки, описания) нужно либо заводить их в 1С, либо давать доступ контент-менеджерам в Битрикс с осторожностью.

#### **Схема 2: Сайт как "Расширенная Витрина" (Гибридная)**

*   **Описание:** Основные данные (артикул, название, базовая цена, остаток) загружаются из 1С. Но часть информации (детальные описания, SEO-теги, дополнительные фото) можно редактировать непосредственно на сайте.
*   **Направление обмена:**
    *   **Из 1С -> на Сайт:** Базовая номенклатура, остатки, цены.
    *   **С Сайта -> в 1С:** Заказы.
    *   *Обмен в обе стороны для товаров:* Настроено так, что 1С является приоритетом для основных полей, но некоторые поля (описание) не перезаписываются при обмене.
*   **Плюсы:**
    *   **Гибкость:** Маркетологи могут быстро вносить правки в контент, не обращаясь к 1С-специалисту.
*   **Минусы:**
    *   **Сложность настройки:** Требуется тонкая настройка правил обмена, чтобы данные не "затирались".
    *   **Риск рассинхронизации:** Нужен четкий регламент, кто и что редактирует.

#### **Схема 3: Упрощенная (Только заказы)**

*   **Описание:** Каталог товаров полностью ведется вручную в админке Битрикс. В 1С выгружаются только заказы.
*   **Плюсы:** Очень проста в настройке.
*   **Минусы:** Полностью ручное управление каталогом, не подходит для магазинов с большим и изменчивым ассортиментом.

---

### **Типичные проблемы и их решение**

1.  **"Обмен завершен. Изменений нет"**
    *   *Причина:* Данные в 1С не менялись с момента последнего успешного обмена.
    *   *Решение:* В 1С принудительно пометить данные для обмена или запустить полный обмен.

2.  **"Ошибка авторизации"**
    *   *Причина:* Неверно указаны логин, пароль или адрес обмена в настройках 1С.
    *   *Решение:* Проверить и перепроверить данные из профиля обмена в Битрикс.

3.  **Товары не загружаются/загружаются с ошибками**
    *   *Причина:* Неправильное сопоставление полей (например, свойству "Цвет" в Битриксе соответствует не тот реквизит в 1С).
    *   *Решение:* Внимательно проверить правила сопоставления в настройках обмена в 1С. Проверить логи обмена (файл `bitrix/catalog_import/1c_*.log`).

4.  **Заказы не выгружаются в 1С**
    *   *Причина:* Неправильно настроен сценарий выгрузки заказов или у заказа не тот статус.
    *   *Решение:* Проверить в настройках профиля обмена в Битрикс, при каком статусе заказ выгружается в 1С.

**Вывод:** Интеграция Битрикс с 1С — это мощный инструмент, который превращает разрозненные системы в единый автоматизированный контур управления продажами. Настройка требует внимательности, особенно на этапе сопоставления данных, но результат — значительная экономия времени и исключение человеческих ошибок.
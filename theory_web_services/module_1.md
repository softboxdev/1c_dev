
### Модуль 1. Теория XML и JSON

---

#### 1. Знакомство с Web-сервисами

**Веб-сервис** — это программная система, предназначенная для взаимодействия "машина-машина" по сети. Ключевая идея — стандартизация способа обмена данными между разными приложениями, независимо от платформы, языка программирования или операционной системы.

*   **Аналогия:** Представьте, что вы заказываете еду через приложение. Приложение (ваша программа) не готовит еду само, а обращается к сервису ресторана (веб-сервису) через стандартное меню (API), передает ему ваш заказ (запрос) и получает готовую еду (ответ).
*   **Основные принципы:**
    *   **Инкапсуляция:** Сервис выполняет одну конкретную бизнес-функцию.
    *   **Слабая связность:** Приложения-потребители и сервис минимально зависят друг от друга.
    *   **Переиспользование:** Функциональность сервиса можно использовать в разных приложениях.
    *   **Стандартизированный интерфейс:** Общение происходит по строго определенным правилам.

---

#### 2. Знакомство с XML

**XML (eXtensible Markup Language)** — это расширяемый язык разметки. Его главная задача — хранить и передавать структурированные данные в удобочитаемом как для человека, так и для машины формате.

*   **Синтаксис:** Напоминает HTML, но теги определяются самим разработчиком.
    ```xml
    <book>
        <title>Война и мир</title>
        <author>Лев Толстой</author>
        <year>1869</year>
        <price currency="RUB">1200</price>
    </book>
    ```
*   **Ключевые особенности:**
    *   **Структурированность:** Позволяет создавать сложные иерархические структуры.
    *   **Самодокументированность:** Имена тегов и атрибутов обычно несут смысл.
    *   **Строгий синтаксис:** Обязательное наличие корневого элемента, закрывающих тегов, корректная вложенность. Это делает его надежным, но более "тяжелым".
    *   **Широко используется:** в конфигурационных файлах, документах (OOXML, ODF), протоколах вроде SOAP.

---

#### 3. Знакомство с JSON

**JSON (JavaScript Object Notation)** — это простой и легковесный формат для обмена данными, основанный на синтаксисе JavaScript. На сегодняшний день это *де-факто* стандарт для веб-API.

*   **Синтаксис:** Представляет собой пары "ключ-значение" и упорядоченные списки.
    ```json
    {
      "book": {
        "title": "Война и мир",
        "author": "Лев Толстой",
        "year": 1869,
        "price": {
          "value": 1200,
          "currency": "RUB"
        }
      }
    }
    ```
*   **Ключевые особенности:**
    *   **Легковесность:** Меньше служебных символов, чем в XML, поэтому размер данных меньше.
    *   **Простота парсинга:** Легко и быстро обрабатывается как в JavaScript (через `JSON.parse()`), так и в большинстве других языков.
    *   **Удобство для JavaScript:** Является его подмножеством, что делает его идеальным для веб-приложений.

---

#### 4. Знакомство с XDTO

**XDTO (XML Data Transfer Objects)** — это технология в платформе 1С:Предприятие для работы с XML-данными на основе **XSD-схем**.

*   **Суть:** XDTO позволяет сопоставить структуру XML с объектами 1С.
*   **Как работает:**
    1.  Вы описываете структуру данных в виде XSD-схемы (XML Schema Definition).
    2.  На основе этой схемы в 1С создается **XDTO-фабрика**.
    3.  Фабрика позволяет создавать **XDTO-объекты**, которые соответствуют структуре, описанной в схеме.
    4.  Вы можете легко сериализовать (преобразовать в XML) эти объекты и десериализовать (создать объекты из XML).
*   **Зачем нужно:** Обеспечивает строгую типизацию и проверку данных при работе с XML, особенно с веб-сервисами. Это гарантирует, что отправляемые и получаемые XML-документы соответствуют ожидаемому формату.

---

#### 5. Знакомство с технологией SOA, протокол SOAP

**SOA (Service-Oriented Architecture, Сервис-Ориентированная Архитектура)** — это архитектурный подход, при котором приложение строится как набор слабосвязанных, взаимодействующих друг с другом сервисов.

*   **Сервис** — это автономная бизнес-функция (например, "Получить курс валют", "Создать заказ").
*   **Веб-сервисы (SOAP/WSDL)** являются одной из технологических реализаций принципов SOA.

**SOAP (Simple Object Access Protocol)** — это протокол для обмена структурированными сообщениями в компьютерных сетях. Изначально он был частью стека технологий для реализации SOA.

*   **Особенности SOAP:**
    *   **XML-based:** Все сообщения — в формате XML.
    *   **Протокол-независимый:** Может работать поверх HTTP, SMTP, JMS и др. (но чаще всего используется HTTP).
    *   **Строгая стандартизация:** Имеет строгие стандарты для безопасности, транзакций, надежности (WS-* стандарты).
    *   **"Тяжелый":** Из-за XML и сложных стандартов сообщения получаются большими, а обмен — медленнее по сравнению с легковесными альтернативами.

**Структура SOAP-сообщения:**
```xml
<soap:Envelope xmlns:soap="http://www.w3.org/2003/05/soap-envelope/">
   <soap:Header>
      <!-- Опциональная информация: данные для аутентификации, о транзакциях и т.д. -->
   </soap:Header>
   <soap:Body>
      <!-- Основное содержимое запроса или ответа -->
      <m:GetBookPrice xmlns:m="http://www.example.org/books">
         <m:BookTitle>Война и мир</m:BookTitle>
      </m:GetBookPrice>
   </soap:Body>
</soap:Envelope>
```

---

#### 6. Разработка WSDL-описания Web-сервиса

**WSDL (Web Services Description Language)** — это язык описания веб-сервисов на основе XML. По сути, это **контракт** между сервисом и его потребителем.

WSDL-документ точно описывает:
*   **Что делает сервис?** (доступные операции — `operations`).
*   **Как к нему обращаться?** (протокол и формат сообщения — `binding`).
*   **Где он находится?** (сетевой адрес — `port`).

**Основные части WSDL:**
*   **`types`:** Описывает типы данных, используемые в сервисе (часто через XSD).
*   **`message`:** Описывает формат сообщения (запроса и ответа).
*   **`portType`:** Описывает сами операции (например, `getBookPrice`), какие сообщения она принимает и возвращает.
*   **`binding`:** Связывает `portType` с конкретным протоколом (например, SOAP over HTTP).
*   **`service`:** Указывает конкретный адрес (URL) сервиса.

На основе WSDL клиенты могут автоматически генерировать код для вызова вашего сервиса.

---

#### 7. Отличия Web-сервисов (SOAP) и HTTP-сервисов (REST). Плюсы и минусы

Здесь под "Web-сервисами" обычно подразумевают SOAP-сервисы, а под "HTTP-сервисами" — RESTful API.

| Характеристика | SOAP Web-сервисы | HTTP-сервисы (REST) |
| :--- | :--- | :--- |
| **Протокол** | Может работать поверх разных протоколов, но чаще HTTP. | **Только HTTP.** Использует его методы (GET, POST, PUT, DELETE). |
| **Формат данных** | **Только XML.** | **Любой** (JSON, XML, plain text), но **JSON** — стандарт де-факто. |
| **Стандарты** | **Строгие и сложные** (WSDL, SOAP, WS-Security и др.). | **Гибкие, основаны на принципах REST** (Единый интерфейс, Stateless, Кэшируемость). |
| **Вес** | **"Тяжелый"**, большой объем служебной информации. | **"Легковесный"**, минимум служебных данных. |
| **Кэширование** | Сложно реализуемо. | **Легко кэшируется** благодаря использованию HTTP. |
| **Безопасность** | **Мощные встроенные стандарты** (WS-Security). | **Использует стандарты HTTP** (HTTPS, OAuth, JWT). |
| **Сложность разработки** | Выше, требуется генерация кода из WSDL. | Ниже, проще для понимания и быстрого старта. |

**Плюсы и минусы:**

*   **SOAP:**
    *   **Плюсы:** Стандартизация, безопасность, надежность, поддержка транзакций. Идеален для корпоративных систем (например, в 1С для межпрограммного обмена).
    *   **Минусы:** Сложность, избыточность, медленнее.

*   **REST:**
    *   **Плюсы:** Простота, гибкость, производительность, легкость для клиентов (мобильные приложения, JS-фреймворки).
    *   **Минусы:** Меньшая стандартизация (требует дисциплины от разработчика), нет встроенной поддержки сложных бизнес-транзакций.

---

#### 8. Объекты метаданных для работы с Web-сервисами и HTTP-сервисами в 1С

В 1С:Предприятие для публикации сервисов используются следующие объекты метаданных:

*   **Для SOAP Web-сервисов:**
    1.  **`WSСсылки` (WS-References):** Позволяют подключиться и использовать *внешний* SOAP-сервис из 1С. 1С автоматически создает объекты для работы с ним на основе его WSDL.
    2.  **`WSСервисы` (WS-Services):** Позволяют описать и опубликовать *собственный* SOAP-сервис *изнутри* 1С. Вы описываете операции и их параметры непосредственно в конфигураторе.

*   **Для HTTP-сервисов (REST):**
    1.  **`HTTPСервисы` (HTTP Services):** Позволяют опубликовать *собственный* REST-like API. Вы указываете URL-шаблон и обработчик (например, `catalog/books/{id}`), который будет вызван при обращении по этому адресу. Обработчик пишется на встроенном языке 1С в модуле обработчика.

**Связь с XDTO:** При работе с `WSСервисами` и `WSСсылками` для описания сложных типов данных активно используется **XDTO**. Вы можете использовать стандартные XDTO-пакеты (из библиотеки XDTO) или создавать свои на основе XSD-схем.